{"version":3,"sources":["serviceWorker.ts","components/router/index.tsx","mappers/playlist.ts","contexts/playlist.tsx","contexts/index.tsx","index.tsx","contexts/event.tsx","services/gtm.ts","utils/string.ts","contexts/user.tsx","services/request.ts","utils/logger.ts","services/storage.ts","mappers/image.ts","mappers/music.ts","services/message.ts","utils/firebase.ts","utils/timer.ts","utils/player.ts","contexts/player.tsx","components/loader/loader.svg","components/loader/index.tsx","contexts/new-context.tsx","mappers/search.ts","contexts/search.tsx","contexts/auth.tsx","utils/spotify.ts"],"names":["Boolean","window","location","hostname","match","ContextIntro","children","rest","isAuthenticated","useAuth","render","cookieService","get","CONTEXT_COOKIE_NAME","to","pathname","state","from","PrivateRoute","NonAuthRoute","PlaylistMapper","id","name","description","images","tracks","title","StringUtil","sliceIfNeed","image","alt","src","url","musics","items","map","t","MusicMapper","toMusic","track","PlaylistContext","createContext","spotifyPlaylistsEndpoint","SpotifyUtil","getApiUrl","spotifyLoadPlaylistEndpoint","PlaylistProvider","props","useUser","profile","requestService","playlistId","musicsIds","a","post","data","uris","toBasicPlaylist","toPlaylist","newName","put","Provider","value","addMusics","create","load","loadAll","rename","AppProviders","Home","React","lazy","Welcome","Login","LoginRedirectSpotify","Logout","Artists","Gender","Feeling","Activity","Location","MusicSearch","Recommendation","theme","createMuiTheme","palette","primary","main","secondary","indigo","responsiveFontSizes","ReactDOM","fallback","ThemeProvider","path","exact","key","type","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console","message","EventType","gtmService","eventName","customProps","tagsWereNotFired","dataLayer","push","event","LoggerUtil","log","ex","apiEndpoint","process","REACT_APP_API_HOST","eventApiEndpoint","UserContext","eventsHistory","EventsProvider","spotifyUserUri","uri","hasToSaveTheEvent","sendEvent","FirebaseUtil","addNew","action","createdDateTime","Date","toISOString","lastEvent","length","PAUSE_MUSIC","PLAY_MUSIC","save","useEvents","useContext","any","trim","str","size","slice","normalize","replace","toLowerCase","Error","toString","def","spotifyUserEndpoint","UserProvider","useState","setProfile","email","display_name","link","external_urls","spotify","avatarSrc","tryToSaveAtApi","spotifyUri","endpoint","devices","basicUser","useEffect","getAvailableDevices","RequestService","getRequest","request","this","parseRequest","axios","response","mapAxiosToResponse","postRequest","method","putRequest","isString","headers","status","SpotifyRequestService","accessToken","Authorization","args","_do","filter","cookie","includes","start","indexOf","substring","split","decodeURIComponent","expiresInSeconds","expires","date","setTime","getTime","toUTCString","ImageMapper","album","toCustom","messageService","alert","db","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","database","ref","set","TimerUtil","callback","wait","timeout","params","clearTimeout","setTimeout","time","Promise","resolve","musicHistory","PlayerUtil","track_window","current_track","next_tracks","previous_tracks","lastMusic","position","RESTART_MUSIC","paused","returned","some","CHANGE_TO_NEXT_MUSIC","CHANGE_TO_PREVIOUS_MUSIC","MusicContext","debounce","saveEvent","stateToEvent","PlayerProvider","player","setPlayer","playerHasError","setPlayerHasError","isPluginPlayerActive","setIsPluginPlayerActive","isPlayerReady","setIsPlayerReady","playingMusicInfo","setPlayingMusicInfo","createSpotifyPlayerIfNeed","createPlayer","loadCurrentPlayerInfo","getCurrentPlayerInfo","currentPlayer","device","device_id","original","nextTrack","previousTrack","togglePlay","device_ids","reason","warn","createSpotifyPlayerIfNeedAndValidatePlayer","addListener","duration","currentTrack","toMusicTrack","transferUserPlaybackToPlugin","usePlayer","_extends","Object","assign","target","i","arguments","source","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_ref2","createElement","_ref3","className","d","_ref4","_ref5","_ref6","_ref7","_ref8","_ref9","_ref10","_ref11","_ref","svgRef","viewBox","undefined","ForwardRef","forwardRef","Loader","USE_API","REACT_APP_USE_API_TO_LOAD_FEELINGS","baseHost","NewCtxContext","NewContextProvider","text","searchFromApi","searchFromJson","l","toKebabCase","searchActivity","searchFeeling","searchLocation","useNewContext","SearchMapper","SearchContext","spotifySearchEndpoint","SearchProvider","search","q","artists","toArtist","searchArtists","searchMusic","useSearch","AuthContext","AuthProvider","setAccessToken","setRequestService","setIsAuthenticated","isEmpty","logout","delete","confirm","spotifyLogoutWindow","open","close","saveToken","redirectUrl","getTokenAndInfoFromRedirectUrl","newAccessToken","reject","script","charset","async","onload","onerror","body","appendChild","URL","searchParams","getSpotifyRedirectUrl","SCOPES","join","onSpotifyWebPlaybackSDKReady","Spotify","Player","getOAuthToken","cb","connect","loadSpotifyScripts","hash","Number","tokenType"],"mappings":"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","file":"static/js/main.f5b5e873.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\r\nimport { useAuth } from \"../../contexts/auth\";\r\nimport { Route, Redirect } from \"react-router-dom\";\r\nimport { cookieService } from \"../../services/storage\";\r\n\r\nexport function ContextIntro({ children, ...rest }: any) {\r\n  const { isAuthenticated } = useAuth();\r\n\r\n  return (\r\n    <Route\r\n      {...rest}\r\n      render={({ location }) =>\r\n        !isAuthenticated || cookieService.get(cookieService.CONTEXT_COOKIE_NAME) === \"true\" ? (\r\n          children\r\n        ) : (\r\n          <Redirect\r\n            to={{\r\n              pathname: \"/new-context\",\r\n              state: { from: location },\r\n            }}\r\n          />\r\n        )\r\n      }\r\n    />\r\n  );\r\n}\r\n\r\nexport function PrivateRoute({ children, ...rest }: any) {\r\n  const { isAuthenticated } = useAuth();\r\n\r\n  return (\r\n    <Route\r\n      {...rest}\r\n      render={({ location }) =>\r\n        isAuthenticated ? (\r\n          children\r\n        ) : (\r\n          <Redirect\r\n            to={{\r\n              pathname: \"/welcome\",\r\n              state: { from: location },\r\n            }}\r\n          />\r\n        )\r\n      }\r\n    />\r\n  );\r\n}\r\n\r\nexport function NonAuthRoute({ children, ...rest }: any) {\r\n  const { isAuthenticated } = useAuth();\r\n\r\n  return (\r\n    <Route\r\n      {...rest}\r\n      render={({ location }) =>\r\n        !isAuthenticated ? (\r\n          children\r\n        ) : (\r\n          <Redirect\r\n            to={{\r\n              pathname: \"/\",\r\n              state: { from: location },\r\n            }}\r\n          />\r\n        )\r\n      }\r\n    />\r\n  );\r\n}\r\n","import { BasicPlaylist, Playlist } from \"../@types/playlist\";\r\nimport { PlaylistItem } from \"../@types/spotify\";\r\nimport { StringUtil } from \"../utils/string\";\r\nimport { MusicMapper } from \"./music\";\r\n\r\nexport class PlaylistMapper {\r\n  static toPlaylist({\r\n    id,\r\n    name,\r\n    description,\r\n    images,\r\n    tracks,\r\n  }: import(\"../@types/spotify\").SpotifyLoadPlaylistResponse): Playlist {\r\n    return {\r\n      id,\r\n      title: name,\r\n      description: StringUtil.sliceIfNeed(description),\r\n      image: {\r\n        alt: name,\r\n        src: images[0]?.url,\r\n      },\r\n      musics: tracks.items.map((t) => MusicMapper.toMusic(t.track)),\r\n    };\r\n  }\r\n\r\n  static toBasicPlaylist({ id, name, images, description }: PlaylistItem): BasicPlaylist {\r\n    return {\r\n      id,\r\n      title: name,\r\n      description: StringUtil.sliceIfNeed(description),\r\n      image: {\r\n        alt: name,\r\n        src: images[0]?.url,\r\n      },\r\n    };\r\n  }\r\n}\r\n","import React, { createContext, useContext } from \"react\";\r\nimport { useAuth } from \"./auth\";\r\n\r\nimport { SpotifyUtil } from \"../utils/spotify\";\r\nimport { PlaylistMapper } from \"../mappers/playlist\";\r\nimport { BasicPlaylist, Playlist } from \"../@types/playlist\";\r\nimport { SpotifyLoadPlaylistResponse, SpotifyLoadUserPlaylistsResponse } from \"../@types/spotify\";\r\nimport { useUser } from \"./user\";\r\n\r\ninterface Props {}\r\n\r\ninterface Context {\r\n  addMusics: (playlistId: string, musicsIds: string[]) => Promise<void>;\r\n  create: () => Promise<string>;\r\n  loadAll: () => Promise<BasicPlaylist[]>;\r\n  load: (id: string) => Promise<Playlist>;\r\n  rename: (playlistId: string, newName: string) => Promise<void>;\r\n}\r\n\r\nconst PlaylistContext = createContext({} as any);\r\nconst spotifyPlaylistsEndpoint = `${SpotifyUtil.getApiUrl()}/me/playlists`;\r\nconst spotifyLoadPlaylistEndpoint = `${SpotifyUtil.getApiUrl()}/playlists`;\r\n\r\nexport function PlaylistProvider(props: Props) {\r\n  const {\r\n    profile: { id },\r\n  } = useUser();\r\n  const { requestService } = useAuth();\r\n\r\n  async function addMusics(playlistId: string, musicsIds: string[]): Promise<void> {\r\n    await requestService.post({\r\n      url: `${spotifyLoadPlaylistEndpoint}/${playlistId}/tracks`,\r\n      data: {\r\n        uris: musicsIds,\r\n      },\r\n    });\r\n  }\r\n\r\n  async function create(): Promise<string> {\r\n    const { data } = await requestService.post<SpotifyLoadPlaylistResponse>({\r\n      url: `${SpotifyUtil.getApiUrl()}/users/${id}/playlists`,\r\n      data: {\r\n        name: \"Nova playlist\",\r\n      },\r\n    });\r\n\r\n    return data.id;\r\n  }\r\n\r\n  async function loadAll(): Promise<BasicPlaylist[]> {\r\n    const { data } = await requestService.get<SpotifyLoadUserPlaylistsResponse>({\r\n      url: spotifyPlaylistsEndpoint,\r\n    });\r\n\r\n    return data.items.map(PlaylistMapper.toBasicPlaylist);\r\n  }\r\n\r\n  async function load(id: string): Promise<Playlist> {\r\n    const { data } = await requestService.get<SpotifyLoadPlaylistResponse>({\r\n      url: `${spotifyLoadPlaylistEndpoint}/${id}`,\r\n    });\r\n\r\n    return PlaylistMapper.toPlaylist(data);\r\n  }\r\n\r\n  async function rename(playlistId: string, newName: string): Promise<void> {\r\n    await requestService.put({\r\n      url: `${spotifyLoadPlaylistEndpoint}/${playlistId}`,\r\n      data: {\r\n        name: newName,\r\n      },\r\n    });\r\n  }\r\n\r\n  return <PlaylistContext.Provider value={{ addMusics, create, load, loadAll, rename }} {...props} />;\r\n}\r\n\r\nexport const usePlaylist = () => useContext<Context>(PlaylistContext);\r\n","import React from \"react\";\r\n\r\nimport { AuthProvider } from \"./auth\";\r\nimport { EventsProvider } from \"./event\";\r\nimport { NewContextProvider } from \"./new-context\";\r\nimport { PlayerProvider } from \"./player\";\r\nimport { PlaylistProvider } from \"./playlist\";\r\nimport { SearchProvider } from \"./search\";\r\nimport { UserProvider } from \"./user\";\r\n\r\ninterface Props {\r\n  children: JSX.Element;\r\n}\r\n\r\nexport function AppProviders({ children }: Props) {\r\n  return (\r\n    <AuthProvider>\r\n      <UserProvider>\r\n        <EventsProvider>\r\n          <PlaylistProvider>\r\n            <PlayerProvider>\r\n              <NewContextProvider>\r\n                <SearchProvider>{children}</SearchProvider>\r\n              </NewContextProvider>\r\n            </PlayerProvider>\r\n          </PlaylistProvider>\r\n        </EventsProvider>\r\n      </UserProvider>\r\n    </AuthProvider>\r\n  );\r\n}\r\n","import React, { Suspense, StrictMode } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.scss\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\nimport { HashRouter, Switch } from \"react-router-dom\";\r\nimport { Loader } from \"./components/loader\";\r\nimport { PrivateRoute, NonAuthRoute, ContextIntro } from \"./components/router\";\r\nimport { AppProviders } from \"./contexts\";\r\nimport { createMuiTheme, ThemeProvider, responsiveFontSizes } from \"@material-ui/core/styles\";\r\nimport { indigo } from \"@material-ui/core/colors\";\r\n\r\nconst Home = React.lazy(() => import(\"./pages/home\"));\r\nconst Welcome = React.lazy(() => import(\"./pages/welcome\"));\r\nconst Login = React.lazy(() => import(\"./pages/login\"));\r\nconst LoginRedirectSpotify = React.lazy(() => import(\"./pages/login-redirect-spotify\"));\r\nconst Logout = React.lazy(() => import(\"./pages/logout\"));\r\nconst Artists = React.lazy(() => import(\"./pages/artists\"));\r\nconst Gender = React.lazy(() => import(\"./pages/genre\"));\r\nconst Feeling = React.lazy(() => import(\"./pages/feeling\"));\r\nconst Activity = React.lazy(() => import(\"./pages/activity\"));\r\nconst Location = React.lazy(() => import(\"./pages/location\"));\r\nconst MusicSearch = React.lazy(() => import(\"./pages/music-search\"));\r\nconst Recommendation = React.lazy(() => import(\"./pages/recommendation\"));\r\n\r\nlet theme = createMuiTheme({\r\n  palette: {\r\n    primary: {\r\n      main: \"#282828\",\r\n    },\r\n    secondary: indigo,\r\n  },\r\n});\r\n\r\ntheme = responsiveFontSizes(theme);\r\n\r\nReactDOM.render(\r\n  <StrictMode>\r\n    <Suspense fallback={<Loader />}>\r\n      <AppProviders>\r\n        <ThemeProvider theme={theme}>\r\n          <HashRouter>\r\n            <Switch>\r\n              <NonAuthRoute path=\"/login\">\r\n                <Login />\r\n              </NonAuthRoute>\r\n              <NonAuthRoute path=\"/login-redirect-spotify\">\r\n                <LoginRedirectSpotify />\r\n              </NonAuthRoute>\r\n              <NonAuthRoute exact path=\"/:access_token(access_token=.*)\">\r\n                <LoginRedirectSpotify />\r\n              </NonAuthRoute>\r\n              <NonAuthRoute path=\"/welcome\">\r\n                <Welcome />\r\n              </NonAuthRoute>\r\n              <PrivateRoute path=\"/new-context\" exact>\r\n                <Feeling key=\"feeling\" type=\"feeling\" />\r\n              </PrivateRoute>\r\n              <PrivateRoute path=\"/new-context/want-to-fell-like\">\r\n                <Feeling key=\"want-to-fell-like\" type=\"want-to-fell-like\" />\r\n              </PrivateRoute>\r\n              <PrivateRoute path=\"/new-context/activity\">\r\n                <Activity />\r\n              </PrivateRoute>\r\n              <PrivateRoute path=\"/new-context/location\">\r\n                <Location />\r\n              </PrivateRoute>\r\n              <ContextIntro>\r\n                <PrivateRoute path=\"/recommendation\">\r\n                  <Recommendation />\r\n                </PrivateRoute>\r\n                <PrivateRoute path=\"/music-search\">\r\n                  <MusicSearch />\r\n                </PrivateRoute>\r\n                <PrivateRoute path=\"/gender\">\r\n                  <Gender />\r\n                </PrivateRoute>\r\n                <PrivateRoute path=\"/artists\">\r\n                  <Artists />\r\n                </PrivateRoute>\r\n                <PrivateRoute path=\"/logout\">\r\n                  <Logout />\r\n                </PrivateRoute>\r\n                <PrivateRoute path=\"/\" exact>\r\n                  <Home />\r\n                </PrivateRoute>\r\n              </ContextIntro>\r\n            </Switch>\r\n          </HashRouter>\r\n        </ThemeProvider>\r\n      </AppProviders>\r\n    </Suspense>\r\n  </StrictMode>,\r\n  document.getElementById(\"root\")\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n","import React, { createContext, useContext } from \"react\";\r\n\r\nimport { gtmService } from \"../services/gtm\";\r\nimport { requestService } from \"../services/request\";\r\nimport { useUser } from \"./user\";\r\nimport { FirebaseUtil } from \"../utils/firebase\";\r\n\r\ninterface Props {}\r\n\r\nexport enum EventType {\r\n  CHANGE_MUSIC_TIME = \"CHANGE_MUSIC_TIME\",\r\n  CHANGE_TO_NEXT_MUSIC = \"CHANGE_TO_NEXT_MUSIC\",\r\n  CHANGE_TO_PREVIOUS_MUSIC = \"CHANGE_TO_PREVIOUS_MUSIC\",\r\n  CHOOSE_ACTIVITY = \"CHOOSE_ACTIVITY\",\r\n  CHOOSE_FEELING = \"CHOOSE_FEELING\",\r\n  CHOOSE_FEELING_TO_BE_LIKE = \"CHOOSE_FEELING_TO_BE_LIKE\",\r\n  CHOOSE_LOCATION = \"CHOOSE_LOCATION\",\r\n  HATED_MUSIC = \"HATED_MUSIC\",\r\n  HIDE_DETAILS = \"HIDE_DETAILS\",\r\n  LIKED_ARTIST = \"LIKED_ARTIST\",\r\n  LIKED_GENRE = \"LIKED_GENRE\",\r\n  LIKED_MUSIC = \"LIKED_MUSIC\",\r\n  LOAD_LOCATION = \"LOAD_LOCATION\",\r\n  PAUSE_MUSIC = \"PAUSE_MUSIC\",\r\n  PLAY_MUSIC = \"PLAY_MUSIC\",\r\n  RESTART_MUSIC = \"RESTART_MUSIC\",\r\n  SHOW_DETAILS = \"SHOW_DETAILS\",\r\n}\r\n\r\ninterface Context {\r\n  save: (type: EventType, value?: string) => Promise<void>;\r\n}\r\n\r\nconst apiEndpoint = process.env.REACT_APP_API_HOST || \"https://localhost:44301/api\";\r\nconst eventApiEndpoint = `${apiEndpoint}/UserEvents`;\r\n\r\nconst UserContext = createContext({} as any);\r\nconst useGTM = process.env.REACT_APP_USE_GTM !== \"false\";\r\nconst eventsHistory: EventType[] = [];\r\n\r\nexport function EventsProvider(props: Props) {\r\n  const { profile } = useUser();\r\n  const spotifyUserUri = profile.uri;\r\n\r\n  async function save(type: EventType, value?: string): Promise<void> {\r\n    const data = { type, value, spotifyUserUri };\r\n\r\n    if (hasToSaveTheEvent(type)) {\r\n      if (useGTM) {\r\n        gtmService.sendEvent(\"USER_ACTION\", data);\r\n      } else {\r\n        await requestService.post({ url: eventApiEndpoint, data });\r\n      }\r\n\r\n      FirebaseUtil.addNew(`events/${spotifyUserUri}`, {\r\n        action: type,\r\n        value,\r\n        createdDateTime: new Date().toISOString(),\r\n      });\r\n    }\r\n  }\r\n\r\n  function hasToSaveTheEvent(type: EventType) {\r\n    const lastEvent = eventsHistory[eventsHistory.length - 1];\r\n\r\n    eventsHistory.push(type);\r\n\r\n    return !(type === lastEvent && (type === EventType.PAUSE_MUSIC || type === EventType.PLAY_MUSIC));\r\n  }\r\n\r\n  return <UserContext.Provider value={{ save }} {...props} />;\r\n}\r\n\r\nexport const useEvents = () => useContext<Context>(UserContext);\r\n","import { LoggerUtil } from \"../utils/logger\"\r\n\r\ninterface DataLayer {\r\n  event?: string\r\n}\r\n\r\ndeclare const dataLayer: DataLayer[]\r\n\r\nclass GtmService {\r\n  sendEvent(eventName: string, customProps: object = {}): boolean {\r\n    let tagsWereNotFired = false\r\n\r\n    try {\r\n      tagsWereNotFired = !!dataLayer.push({\r\n        event: eventName,\r\n        ...customProps,\r\n      })\r\n\r\n      if (tagsWereNotFired) {\r\n        LoggerUtil.log('There is no gtm tags for the event: ', eventName)\r\n      }\r\n    } catch (ex) {\r\n      LoggerUtil.log('There was a problem to send the gtm event ', ex)\r\n    }\r\n\r\n    return tagsWereNotFired\r\n  }\r\n}\r\n\r\nexport const gtmService = new GtmService()","export class StringUtil {\r\n  static isEmpty<T>(any: T): boolean {\r\n    return any == null || (typeof any === \"string\" && any.trim().length === 0);\r\n  }\r\n\r\n  static isString<T>(any: T): boolean {\r\n    return typeof any === \"string\";\r\n  }\r\n\r\n  static sliceIfNeed(str: string, size: number = 50): string {\r\n    return str.length > size ? `${str.slice(0, size)}...` : str;\r\n  }\r\n\r\n  static toKebabCase(str: string): string {\r\n    return str\r\n      .normalize('NFD')\r\n      .replace(/[\\u0300-\\u036f]/g, '')\r\n      .replace(/[^-\\w ]/g, '')\r\n      .replace(/-+/g, ' ')\r\n      .trim()\r\n      .replace(/ +/g, '-')\r\n      .toLowerCase()\r\n  }\r\n\r\n  static toString(str: any): string {\r\n    if (!str) {\r\n      throw new Error(\"Invalid str\");\r\n    }\r\n\r\n    return str.toString();\r\n  }\r\n\r\n  static toStringOrDefault(str: any, def: string): string {\r\n    return !str ? def : str.toString();\r\n  }\r\n}\r\n","import React, { createContext, useContext, useState, useEffect } from \"react\";\r\nimport { useAuth } from \"./auth\";\r\n\r\nimport { SpotifyUserGetResponse, SpotifyDevicesResponse, SpotifyDevice } from \"../@types/spotify\";\r\nimport { SpotifyUtil } from \"../utils/spotify\";\r\n\r\ninterface Props {}\r\n\r\nexport interface User {\r\n  id: string;\r\n  avatarSrc: string;\r\n  email: string;\r\n  name: string;\r\n  link: string;\r\n  uri: string;\r\n}\r\n\r\ninterface BasicUser {\r\n  spotifyUri: string;\r\n  name: string;\r\n  avatarSrc: string;\r\n}\r\n\r\ninterface Context {\r\n  getAvailableDevices: () => Promise<SpotifyDevice[]>;\r\n  profile: User;\r\n}\r\n\r\nconst UserContext = createContext({} as any);\r\nconst spotifyUserEndpoint = `${SpotifyUtil.getApiUrl()}/me`;\r\n\r\nconst apiEndpoint = process.env.REACT_APP_API_HOST || \"https://localhost:44301/api\";\r\nconst userApiEndpoint = `${apiEndpoint}/user`;\r\nconst useGTM = process.env.REACT_APP_USE_GTM !== \"false\";\r\n\r\nexport function UserProvider(props: Props) {\r\n  const { isAuthenticated, requestService } = useAuth();\r\n  const [profile, setProfile] = useState<User>({} as any);\r\n\r\n  async function load(): Promise<void> {\r\n    const { data } = await requestService.get<SpotifyUserGetResponse>(spotifyUserEndpoint);\r\n    const {\r\n      id,\r\n      email,\r\n      display_name: name,\r\n      external_urls: { spotify: link },\r\n      images,\r\n      uri,\r\n    } = data;\r\n    const avatarSrc = images[0]?.url;\r\n\r\n    setProfile({ id, email, name, link, avatarSrc, uri });\r\n\r\n    tryToSaveAtApi({ avatarSrc, spotifyUri: uri, name });\r\n  }\r\n\r\n  async function getAvailableDevices(): Promise<SpotifyDevice[]> {\r\n    const endpoint = `${spotifyUserEndpoint}/player/devices`;\r\n    const { data } = await requestService.get<SpotifyDevicesResponse>(endpoint);\r\n\r\n    return data.devices;\r\n  }\r\n\r\n  async function tryToSaveAtApi(basicUser: BasicUser): Promise<void> {\r\n    if (!useGTM) { \r\n      await requestService.post({\r\n        url: userApiEndpoint,\r\n        data: basicUser,\r\n      });\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated) {\r\n      load();\r\n    } else {\r\n      setProfile({} as any);\r\n    } // eslint-disable-next-line\r\n  }, [isAuthenticated]);\r\n\r\n  return <UserContext.Provider value={{ getAvailableDevices, profile }} {...props} />;\r\n}\r\n\r\nexport const useUser = () => useContext<Context>(UserContext);\r\n","import axios, { AxiosResponse } from \"axios\";\r\nimport { StringUtil } from \"../utils/string\";\r\n\r\nexport interface GetRequest {\r\n  url: string;\r\n  headers?: object;\r\n  params?: object;\r\n}\r\n\r\nexport interface PostRequest {\r\n  url: string;\r\n  headers?: object;\r\n  data?: object;\r\n}\r\n\r\nexport interface Response<T> {\r\n  headers?: object;\r\n  data: T;\r\n  status: number;\r\n}\r\n\r\ntype Request = GetRequest | PostRequest;\r\n\r\nclass RequestService {\r\n  async get<T>(getRequest: string | GetRequest): Promise<Response<T>> {\r\n    let request: GetRequest = this.parseRequest(getRequest);\r\n    const response = await axios(request);\r\n\r\n    return this.mapAxiosToResponse(response);\r\n  }\r\n\r\n  async post<T>(postRequest: string | PostRequest): Promise<Response<T>> {\r\n    let request: PostRequest = this.parseRequest(postRequest);\r\n    const response = await axios({ ...request, method: \"post\" });\r\n\r\n    return this.mapAxiosToResponse(response);\r\n  }\r\n\r\n  async put<T>(putRequest: string | PostRequest): Promise<Response<T>> {\r\n    let request: PostRequest = this.parseRequest(putRequest);\r\n    const response = await axios({ ...request, method: \"put\" });\r\n\r\n    return this.mapAxiosToResponse(response);\r\n  }\r\n\r\n  protected parseRequest(getRequest: string | Request): Request {\r\n    let request: Request = getRequest as Request;\r\n\r\n    if (StringUtil.isString(getRequest)) {\r\n      request = { url: getRequest as string };\r\n    }\r\n\r\n    return request;\r\n  }\r\n\r\n  private mapAxiosToResponse<T>(response: AxiosResponse): Response<T> {\r\n    const { data, headers, status } = response;\r\n\r\n    return {\r\n      data,\r\n      headers,\r\n      status,\r\n    };\r\n  }\r\n}\r\n\r\nexport class SpotifyRequestService extends RequestService {\r\n  accessToken: string | null;\r\n\r\n  constructor(accessToken: string | null) {\r\n    super();\r\n    this.accessToken = accessToken;\r\n  }\r\n\r\n  protected parseRequest(getRequest: string | Request): Request {\r\n    const request = super.parseRequest(getRequest);\r\n\r\n    if (this.accessToken == null) {\r\n      throw new Error(\"No access token, you must login!\");\r\n    }\r\n\r\n    request.headers = {\r\n      Authorization: `Bearer ${this.accessToken}`,\r\n    };\r\n\r\n    return request;\r\n  }\r\n}\r\n\r\nexport const requestService = new RequestService();\r\n","import { FirebaseUtil } from \"./firebase\";\r\n\r\nexport class LoggerUtil {\r\n    static log(...args: any[]): void {\r\n        LoggerUtil._do(\"log\", args);\r\n    }\r\n\r\n    static warn(...args: any[]): void {\r\n        LoggerUtil._do(\"warn\", args);\r\n    }\r\n\r\n    static error(...args: any[]): void {\r\n        LoggerUtil._do(\"error\", args);\r\n    }\r\n\r\n    static _do(type: 'log' | 'warn' | 'error', args: any[]) {\r\n        console[type](`[${type}]: `, args);\r\n\r\n        FirebaseUtil.addNew(`log/${type}`, args.filter(Boolean));\r\n    }\r\n}\r\n","class CookieService {\r\n  public readonly CONTEXT_COOKIE_NAME = \"FilledTheContext\";\r\n\r\n  delete(key: string): void {\r\n    document.cookie = key + \"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;\";\r\n  }\r\n\r\n  get(key: string): string {\r\n    const { cookie } = document;\r\n\r\n    let value = \"\";\r\n\r\n    if (cookie.includes(key)) {\r\n      const start = cookie.indexOf(key);\r\n\r\n      value = cookie.substring(start).split(\";\", 1)[0].split(\"=\")[1];\r\n    }\r\n\r\n    return decodeURIComponent(value);\r\n  }\r\n\r\n  save(key: string, value: string, expiresInSeconds?: number): void {\r\n    let expires = \"\";\r\n\r\n    if (!!expiresInSeconds) {\r\n      const date = new Date();\r\n      date.setTime(date.getTime() + expiresInSeconds * 1000);\r\n      expires = \"; expires=\" + date.toUTCString();\r\n    }\r\n\r\n    document.cookie = `${key}=${value}${expires}; path=/`;\r\n  }\r\n}\r\n\r\nexport const cookieService = new CookieService();\r\n","import { SpotifyImage } from \"../@types/spotify\";\r\nimport { CustomImage } from \"../@types/music\";\r\n\r\nexport class ImageMapper {\r\n  static toCustom(alt: string, images: SpotifyImage[]): CustomImage {\r\n    return {\r\n      alt,\r\n      src: images[0]?.url,\r\n    };\r\n  }\r\n}\r\n","import { ImageMapper } from \"./image\";\r\nimport { Music, Album } from \"../@types/music\";\r\nimport { SpotifyTracksSearchItem, SpotifyImage } from \"../@types/spotify\";\r\n\r\nexport class MusicMapper {\r\n  static toMusicTrack({ name, album, uri }: Spotify.Track): Music {\r\n    return {\r\n      id: uri,\r\n      image: ImageMapper.toCustom(name, album.images as SpotifyImage[]),\r\n      name,\r\n      album: {\r\n        id: album.uri,\r\n        name: album.name,\r\n        image: ImageMapper.toCustom(album.name, album.images as SpotifyImage[]),\r\n      },\r\n      uri,\r\n    };\r\n  }\r\n\r\n  static toMusic({ id, name, album, uri }: SpotifyTracksSearchItem): Music {\r\n    return {\r\n      id,\r\n      image: ImageMapper.toCustom(name, album.images),\r\n      name,\r\n      album: {\r\n        id: album.id,\r\n        name: album.name,\r\n        image: ImageMapper.toCustom(album.name, album.images),\r\n      },\r\n      uri,\r\n    };\r\n  }\r\n\r\n  static toAlbum({ id, name, images }: import(\"../@types/spotify\").SpotifyAlbum): Album {\r\n    return {\r\n      id,\r\n      name,\r\n      image: ImageMapper.toCustom(name, images),\r\n    };\r\n  }\r\n}\r\n","class MessageService {\r\n  alert(message: string): void {\r\n    window.alert(message);\r\n  }\r\n}\r\n\r\nexport const messageService = new MessageService();\r\n","import { initializeApp } from \"firebase/app\";\r\nimport 'firebase/database';\r\n\r\nconst firebaseConfigs = {\r\n    apiKey: \"AIzaSyCM4LaAdvGSVav4WCVmtBf2ynJok6uMPGI\",\r\n    authDomain: \"spotify-plugin-app.firebaseapp.com\",\r\n    databaseURL: \"https://spotify-plugin-app.firebaseio.com\",\r\n    projectId: \"spotify-plugin-app\",\r\n    storageBucket: \"spotify-plugin-app.appspot.com\",\r\n    messagingSenderId: \"1000088386798\",\r\n    appId: \"1:1000088386798:web:de8232c75a287f4c9187ff\",\r\n    measurementId: \"G-6DY82HL6BR\",\r\n};\r\n\r\nconst firebaseAdmin = initializeApp(firebaseConfigs);\r\nconst db = firebaseAdmin.database()\r\n\r\nexport class FirebaseUtil {\r\n    static addNew(key: string, data: any): void {\r\n        try {\r\n            var ref = db.ref(key).push()\r\n\r\n            ref.set(data)\r\n        } catch (ex) {\r\n            console.error(\"there was some firebase error\", ex);\r\n        }\r\n    }\r\n}\r\n\r\n","export class TimerUtil {\r\n  static debounce(callback: Function, wait: number): Function {\r\n    let timeout: NodeJS.Timeout | null;\r\n\r\n    return (...params: any[]): void => {\r\n      if (timeout != null) {\r\n        clearTimeout(timeout);\r\n      }\r\n\r\n      timeout = setTimeout((): void => {\r\n        timeout = null;\r\n        callback(...params);\r\n      }, wait);\r\n    };\r\n  }\r\n\r\n  static async wait(time: number): Promise<void> {\r\n    return new Promise((resolve) => setTimeout(() => resolve(), time));\r\n  }\r\n}\r\n","import { EventType } from \"../contexts/event\";\r\n\r\nconst musicHistory: string[] = [];\r\n\r\nexport class PlayerUtil {\r\n  static stateToEvent(state: Spotify.PlaybackState): { type: EventType, value: string } {\r\n    const { current_track, next_tracks, previous_tracks } = state?.track_window;\r\n    const lastMusic = musicHistory[musicHistory.length - 1]\r\n    const value = current_track.uri;\r\n    let type = EventType.PLAY_MUSIC\r\n\r\n    if (value == null)\r\n      throw new Error(\"Invalid current track\");\r\n\r\n    if (state?.position <= 1000)\r\n      type = EventType.RESTART_MUSIC\r\n\r\n    if (state.paused)\r\n      type = EventType.PAUSE_MUSIC\r\n    else if (lastMusic != null) {\r\n      const returned = next_tracks.some(t => t.uri === lastMusic)\r\n      const passed = previous_tracks.some(t => t.uri === lastMusic)\r\n\r\n      if (passed)\r\n        type = EventType.CHANGE_TO_NEXT_MUSIC\r\n      else if (returned)\r\n        type = EventType.CHANGE_TO_PREVIOUS_MUSIC\r\n    }\r\n\r\n    if (lastMusic !== value)\r\n      musicHistory.push(value)\r\n\r\n    return {\r\n      type,\r\n      value\r\n    }\r\n  }\r\n}\r\n","import React, { createContext, useContext, useEffect, useState } from \"react\";\r\n\r\nimport { LoggerUtil } from \"../utils/logger\";\r\nimport { messageService } from \"../services/message\";\r\nimport { Music } from \"../@types/music\";\r\nimport { MusicMapper } from \"../mappers/music\";\r\nimport { PlayerUtil } from \"../utils/player\";\r\nimport { SpotifyPlayerResponse } from \"../@types/spotify\";\r\nimport { SpotifyUtil, SpotifyPlayer } from \"../utils/spotify\";\r\nimport { TimerUtil } from \"../utils/timer\";\r\nimport { useAuth } from \"./auth\";\r\nimport { useEvents } from \"./event\";\r\nimport { useUser } from \"./user\";\r\n\r\ninterface Props {}\r\n\r\ninterface Context {\r\n  isPlayerReady: boolean;\r\n  isPluginPlayerActive: boolean;\r\n  nextTrack: () => Promise<void>;\r\n  playerHasError: boolean;\r\n  playingMusicInfo?: PlayingMusicInfo;\r\n  previousTrack: () => Promise<void>;\r\n  togglePlay: () => Promise<void>;\r\n  transferUserPlaybackToPlugin: () => Promise<void>;\r\n}\r\n\r\nexport interface PlayingMusicInfo {\r\n  position: number;\r\n  duration: number;\r\n  currentTrack: Music;\r\n  paused: boolean;\r\n}\r\n\r\nconst MusicContext = createContext<Context>({} as any);\r\nconst spotifyUserEndpoint = `${SpotifyUtil.getApiUrl()}/me`;\r\n\r\nconst debounce = TimerUtil.debounce((state: Spotify.PlaybackState, saveEvent: Function) => {\r\n  var { type, value } = PlayerUtil.stateToEvent(state);\r\n\r\n  saveEvent(type, value);\r\n}, 1000);\r\n\r\nexport function PlayerProvider(props: Props) {\r\n  const { accessToken, isAuthenticated, requestService } = useAuth();\r\n  const { profile } = useUser();\r\n  const [player, setPlayer] = useState<SpotifyPlayer | null>(null);\r\n  const [playerHasError, setPlayerHasError] = useState<boolean>(false);\r\n  const [isPluginPlayerActive, setIsPluginPlayerActive] = useState<any>(null);\r\n  const [isPlayerReady, setIsPlayerReady] = useState<any>(null);\r\n  const [playingMusicInfo, setPlayingMusicInfo] = useState<PlayingMusicInfo | undefined>();\r\n  const { save: saveEvent } = useEvents();\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated) {\r\n      createSpotifyPlayerIfNeedAndValidatePlayer();\r\n    } // eslint-disable-next-line\r\n  }, [accessToken, isAuthenticated]);\r\n\r\n  useEffect(() => {\r\n    setIsPlayerReady(player != null);\r\n\r\n    if (player != null) {\r\n      player.original.addListener(\"player_state_changed\", (state) => {\r\n        if (state == null) {\r\n          setIsPluginPlayerActive(false);\r\n          messageService.alert(\"Você foi desconectado!\");\r\n        } else {\r\n          const {\r\n            position,\r\n            duration,\r\n            paused,\r\n            track_window: { current_track },\r\n          } = state;\r\n\r\n          debounce(state, saveEvent);\r\n          setPlayingMusicInfo({ currentTrack: MusicMapper.toMusicTrack(current_track), duration, position, paused });\r\n        }\r\n      });\r\n    } // eslint-disable-next-line\r\n  }, [player]);\r\n\r\n  async function createSpotifyPlayerIfNeed(): Promise<void> {\r\n    if (player == null) {\r\n      const player = await SpotifyUtil.createPlayer(accessToken);\r\n\r\n      setPlayer(player);\r\n    }\r\n  }\r\n\r\n  async function createSpotifyPlayerIfNeedAndValidatePlayer(): Promise<void> {\r\n    try {\r\n      await createSpotifyPlayerIfNeed();\r\n      await loadCurrentPlayerInfo();\r\n    } catch (ex) {\r\n      setPlayerHasError(true);\r\n      messageService.alert(\"Tivemos um problema ao conectar ao spotify\");\r\n\r\n      LoggerUtil.error(\"SPOTIFY_CONNECT_PROBLEM\", ex, profile?.id);\r\n    }\r\n  }\r\n\r\n  async function getCurrentPlayerInfo(): Promise<SpotifyPlayerResponse | null> {\r\n    const { data } = await requestService.get<SpotifyPlayerResponse | null>(`${spotifyUserEndpoint}/player`);\r\n\r\n    return data;\r\n  }\r\n\r\n  async function loadCurrentPlayerInfo(): Promise<void> {\r\n    const currentPlayer = await getCurrentPlayerInfo();\r\n\r\n    setIsPluginPlayerActive((currentPlayer?.device != null && player?.device_id) === currentPlayer?.device?.id);\r\n  }\r\n\r\n  async function nextTrack(): Promise<void> {\r\n    if (player == null) {\r\n      throw new Error(\"You have to login first!\");\r\n    }\r\n\r\n    await player.original.nextTrack();\r\n  }\r\n\r\n  async function previousTrack(): Promise<void> {\r\n    if (player == null) {\r\n      throw new Error(\"You have to login first!\");\r\n    }\r\n\r\n    await player.original.previousTrack();\r\n  }\r\n\r\n  async function togglePlay(): Promise<void> {\r\n    if (player == null) {\r\n      throw new Error(\"You have to login first!\");\r\n    }\r\n\r\n    await player.original.togglePlay();\r\n  }\r\n\r\n  async function transferUserPlaybackToPlugin(): Promise<void> {\r\n    const endpoint = `${spotifyUserEndpoint}/player`;\r\n\r\n    try {\r\n      await requestService.put({\r\n        url: endpoint,\r\n        data: {\r\n          device_ids: [player?.device_id],\r\n        },\r\n      });\r\n\r\n      await TimerUtil.wait(500);\r\n      await loadCurrentPlayerInfo();\r\n    } catch (ex) {\r\n      LoggerUtil.error(\"transferUserPlaybackToPlugin\", ex);\r\n\r\n      const { data, status } = ex.response;\r\n\r\n      if (status < 200 || status > 299) {\r\n        if ((data as any)?.error?.reason === \"PREMIUM_REQUIRED\") {\r\n          messageService.alert(\"[USUARIO NÃO PREMIUM] Você precisa ser premium para conectar\");\r\n          LoggerUtil.warn(\"[USUARIO NÃO PREMIUM] Você precisa ser premium para conectar\", profile?.id);\r\n        } else {\r\n          messageService.alert(\"Tivemos um problema ao conectar, tente novamente mais tarde\");\r\n          LoggerUtil.warn(\"Tivemos um problema ao conectar, tente novamente mais tarde\", profile?.id);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return (\r\n    <MusicContext.Provider\r\n      value={{\r\n        isPlayerReady,\r\n        isPluginPlayerActive,\r\n        nextTrack,\r\n        playerHasError,\r\n        playingMusicInfo,\r\n        previousTrack,\r\n        togglePlay,\r\n        transferUserPlaybackToPlugin,\r\n      }}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nexport const usePlayer = () => useContext<Context>(MusicContext);\r\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"title\", null, \"Audio Wave\");\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  className: \"wave-svg-line-1\",\n  \"data-name\": \"Line 1\",\n  d: \"M0.91,15L0.78,15A1,1,0,0,0,0,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H0.91Z\"\n});\n\nvar _ref4 = /*#__PURE__*/React.createElement(\"path\", {\n  className: \"wave-svg-line-2\",\n  \"data-name\": \"Line 2\",\n  d: \"M6.91,9L6.78,9A1,1,0,0,0,6,10V28a1,1,0,1,0,2,0s0,0,0,0V10A1,1,0,0,0,7,9H6.91Z\"\n});\n\nvar _ref5 = /*#__PURE__*/React.createElement(\"path\", {\n  className: \"wave-svg-line-3\",\n  \"data-name\": \"Line 3\",\n  d: \"M12.91,0L12.78,0A1,1,0,0,0,12,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H12.91Z\"\n});\n\nvar _ref6 = /*#__PURE__*/React.createElement(\"path\", {\n  className: \"wave-svg-line-4\",\n  \"data-name\": \"Line 4\",\n  d: \"M18.91,10l-0.12,0A1,1,0,0,0,18,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H18.91Z\"\n});\n\nvar _ref7 = /*#__PURE__*/React.createElement(\"path\", {\n  className: \"wave-svg-line-5\",\n  \"data-name\": \"Line 5\",\n  d: \"M24.91,15l-0.12,0A1,1,0,0,0,24,16v6a1,1,0,0,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H24.91Z\"\n});\n\nvar _ref8 = /*#__PURE__*/React.createElement(\"path\", {\n  className: \"wave-svg-line-6\",\n  \"data-name\": \"Line 6\",\n  d: \"M30.91,10l-0.12,0A1,1,0,0,0,30,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H30.91Z\"\n});\n\nvar _ref9 = /*#__PURE__*/React.createElement(\"path\", {\n  className: \"wave-svg-line-7\",\n  \"data-name\": \"Line 7\",\n  d: \"M36.91,0L36.78,0A1,1,0,0,0,36,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H36.91Z\"\n});\n\nvar _ref10 = /*#__PURE__*/React.createElement(\"path\", {\n  className: \"wave-svg-line-8\",\n  \"data-name\": \"Line 8\",\n  d: \"M42.91,9L42.78,9A1,1,0,0,0,42,10V28a1,1,0,1,0,2,0s0,0,0,0V10a1,1,0,0,0-1-1H42.91Z\"\n});\n\nvar _ref11 = /*#__PURE__*/React.createElement(\"path\", {\n  className: \"wave-svg-line-9\",\n  \"data-name\": \"Line 9\",\n  d: \"M48.91,15l-0.12,0A1,1,0,0,0,48,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H48.91Z\"\n});\n\nvar SvgLoader = function SvgLoader(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    className: \"wave-svg\",\n    \"data-name\": \"Layer 1\",\n    viewBox: \"0 0 50 38.05\",\n    ref: svgRef\n  }, props), title === undefined ? _ref2 : title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9, _ref10, _ref11);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgLoader, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/loader.6699e396.svg\";\nexport { ForwardRef as ReactComponent };","import \"./style.scss\";\r\nimport React from \"react\";\r\n\r\nimport { ReactComponent as LoaderSvg } from \"./loader.svg\";\r\n\r\nexport function Loader(): React.ReactElement {\r\n  return (\r\n    <div className=\"loader-component\">\r\n      <LoaderSvg />\r\n    </div>\r\n  );\r\n}\r\n","import React, { createContext, useContext } from \"react\";\r\nimport { requestService } from \"../services/request\";\r\nimport { StringUtil } from \"../utils/string\";\r\n\r\nexport interface Feeling {\r\n  id: string;\r\n  name: string;\r\n  createdDate?: string;\r\n}\r\n\r\nexport interface Activity {\r\n  id: string;\r\n  name: string;\r\n  createdDate?: string;\r\n}\r\n\r\nexport interface Location {\r\n  id: string;\r\n  name: string;\r\n  createdDate?: string;\r\n}\r\n\r\ninterface Props {}\r\n\r\ninterface Context {\r\n  searchActivity: (text?: string) => Promise<Activity[]>;\r\n  searchFeeling: (text?: string) => Promise<Feeling[]>;\r\n  searchLocation: (text?: string) => Promise<Location[]>;\r\n}\r\n\r\nconst USE_API = process.env.REACT_APP_USE_API_TO_LOAD_FEELINGS === \"true\";\r\nconst apiEndpoint = process.env.REACT_APP_API_HOST || \"https://localhost:44301/api\";\r\nconst baseHost = process.env.REACT_APP_HOST_URL || \"https://ericoloewe.github.io/computer-science-tcc\";\r\n\r\nconst NewCtxContext = createContext({} as any);\r\n\r\nexport function NewContextProvider(props: Props) {\r\n  async function searchActivity(text?: string): Promise<Activity[]> {\r\n    return USE_API ? searchFromApi(\"activities\", text) : searchFromJson(\"activities.json\", text);\r\n  }\r\n\r\n  async function searchFeeling(text?: string): Promise<Feeling[]> {\r\n    return USE_API ? searchFromApi(\"feeling\", text) : searchFromJson(\"feelings.json\", text);\r\n  }\r\n\r\n  async function searchLocation(text?: string): Promise<Feeling[]> {\r\n    return USE_API ? searchFromApi(\"locations\", text) : searchFromJson(\"locations.json\", text);\r\n  }\r\n\r\n  async function searchFromJson(path: string, text?: string): Promise<any[]> {\r\n    const { data } = await requestService.get<string[]>(`${baseHost}/${path}`);\r\n\r\n    return data\r\n      .filter((l) => !text || l.toLowerCase().includes(text?.toLowerCase()))\r\n      .map((l) => ({\r\n        id: StringUtil.toKebabCase(l),\r\n        name: l,\r\n      }));\r\n  }\r\n\r\n  async function searchFromApi(endpoint: string, text?: string): Promise<any[]> {\r\n    const { data } = await requestService.get<any[]>({\r\n      url: `${apiEndpoint}/${endpoint}`,\r\n      params: { text },\r\n    });\r\n\r\n    return data;\r\n  }\r\n\r\n  return <NewCtxContext.Provider value={{ searchActivity, searchFeeling, searchLocation }} {...props} />;\r\n}\r\n\r\nexport const useNewContext = () => useContext<Context>(NewCtxContext);\r\n","import { Artist } from \"../services/artist\";\r\nimport { SpotifyArtistsSearchItem, SpotifyTracksSearchItem } from \"../@types/spotify\";\r\nimport { MusicMapper } from \"./music\";\r\n\r\nexport class SearchMapper {\r\n  static toArtist({ uri, name, images }: SpotifyArtistsSearchItem): Artist {\r\n    return {\r\n      id: uri,\r\n      name,\r\n      image: {\r\n        alt: name,\r\n        src: images[0]?.url,\r\n      },\r\n    };\r\n  }\r\n\r\n  static toMusic(track: SpotifyTracksSearchItem): import(\"../@types/music\").Music {\r\n    return MusicMapper.toMusic(track);\r\n  }\r\n}\r\n","import React, { createContext, useContext } from \"react\";\r\n\r\nimport { Artist } from \"../services/artist\";\r\nimport { SearchMapper } from \"../mappers/search\";\r\nimport { SpotifySearchResponse } from \"../@types/spotify\";\r\nimport { SpotifyUtil } from \"../utils/spotify\";\r\nimport { useAuth } from \"./auth\";\r\nimport { Music } from \"../@types/music\";\r\n\r\ninterface Props {}\r\n\r\ninterface Context {\r\n  searchArtists: (text: string) => Promise<Artist[]>;\r\n  searchMusic: (text: string) => Promise<Music[]>;\r\n}\r\n\r\nconst SearchContext = createContext({} as any);\r\nconst spotifySearchEndpoint = `${SpotifyUtil.getApiUrl()}/search`;\r\n\r\ntype SpotifySearchType = \"album\" | \"artist\" | \"playlist\" | \"track\" | \"show\" | \"episode\";\r\n\r\nexport function SearchProvider(props: Props) {\r\n  const { requestService } = useAuth();\r\n\r\n  async function search(text: string, type: SpotifySearchType): Promise<SpotifySearchResponse> {\r\n    const { data } = await requestService.get<SpotifySearchResponse>({\r\n      url: spotifySearchEndpoint,\r\n      params: { q: text, type },\r\n    });\r\n\r\n    return data;\r\n  }\r\n\r\n  async function searchArtists(text: string): Promise<Artist[]> {\r\n    const { artists } = await search(text, \"artist\");\r\n\r\n    if (!artists) {\r\n      throw new Error(\"Invalid response\");\r\n    }\r\n\r\n    return artists.items.map(SearchMapper.toArtist);\r\n  }\r\n\r\n  async function searchMusic(text: string): Promise<Music[]> {\r\n    const { tracks } = await search(text, \"track\");\r\n\r\n    if (!tracks) {\r\n      throw new Error(\"Invalid response\");\r\n    }\r\n\r\n    return tracks.items.map(SearchMapper.toMusic);\r\n  }\r\n\r\n  return <SearchContext.Provider value={{ searchArtists, searchMusic }} {...props} />;\r\n}\r\n\r\nexport const useSearch = () => useContext<Context>(SearchContext);\r\n","import React, { createContext, useState, useEffect } from \"react\";\r\n\r\nimport { cookieService } from \"../services/storage\";\r\nimport { SpotifyUtil } from \"../utils/spotify\";\r\nimport { StringUtil } from \"../utils/string\";\r\nimport { SpotifyRequestService } from \"../services/request\";\r\n\r\ninterface Props {}\r\ninterface Context {\r\n  accessToken: string;\r\n  isAuthenticated: boolean;\r\n  logout: () => void;\r\n  requestService: SpotifyRequestService;\r\n  saveToken: (redirectUrl: string) => void;\r\n}\r\n\r\nconst COOKIE_NAME = process.env.REACT_APP_COOKIE_NAME || \"SpotifyToken\";\r\nconst AuthContext = createContext({ isAuthenticated: false } as any);\r\n\r\nexport function AuthProvider(props: Props) {\r\n  const [accessToken, setAccessToken] = useState<null | string>(cookieService.get(COOKIE_NAME));\r\n  const [requestService, setRequestService] = useState(new SpotifyRequestService(accessToken));\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n\r\n  function logout(): void {\r\n    setAccessToken(null);\r\n    cookieService.delete(COOKIE_NAME);\r\n\r\n    if (window.confirm(\"Deseja sair do Spotify?\")) {\r\n      const url = \"https://www.spotify.com/logout/\";\r\n\r\n      const spotifyLogoutWindow = window.open(url, \"Spotify Logout\", \"width=700,height=500,top=40,left=40\");\r\n      setTimeout(() => spotifyLogoutWindow?.close(), 5000);\r\n    }\r\n  }\r\n\r\n  function saveToken(redirectUrl: string): void {\r\n    const { accessToken: newAccessToken, expiresInSeconds } = SpotifyUtil.getTokenAndInfoFromRedirectUrl(redirectUrl);\r\n\r\n    cookieService.save(COOKIE_NAME, newAccessToken, expiresInSeconds);\r\n    setAccessToken(newAccessToken);\r\n  }\r\n\r\n  useEffect(() => {\r\n    setIsAuthenticated(!StringUtil.isEmpty(accessToken));\r\n    setRequestService(new SpotifyRequestService(accessToken));\r\n  }, [accessToken]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ logout, saveToken, isAuthenticated, accessToken, requestService }} {...props} />\r\n  );\r\n}\r\n\r\nexport const useAuth = () => React.useContext<Context>(AuthContext);\r\n","\r\nexport interface SpotifyToken {\r\n  accessToken: string;\r\n  expiresInSeconds: number;\r\n  tokenType: string;\r\n}\r\n\r\nexport interface SpotifyPlayer {\r\n  device_id: string;\r\n  original: Spotify.SpotifyPlayer;\r\n}\r\n\r\nasync function loadSpotifyScripts() {\r\n  return new Promise((resolve, reject) => {\r\n    const script = document.createElement(\"script\");\r\n\r\n    script.src = 'https://sdk.scdn.co/spotify-player.js';\r\n    script.charset = \"utf-8\";\r\n    script.async = true;\r\n    script.onload = () => resolve();\r\n    script.onerror = () => reject();\r\n\r\n    document.body.appendChild(script);\r\n  })\r\n}\r\n\r\nexport class SpotifyUtil {\r\n  static SCOPES = [\r\n    \"playlist-modify-private\",\r\n    \"playlist-modify-public\",\r\n    \"playlist-read-private\",\r\n    \"streaming\",\r\n    \"user-library-read\",\r\n    \"user-read-email\",\r\n    \"user-read-playback-state\",\r\n    \"user-read-private\",\r\n    \"user-read-recently-played\",\r\n    \"user-top-read\",\r\n  ];\r\n\r\n  static createSpotifyAuthUrl(): string {\r\n    if (!process.env.REACT_APP_SPOTIFY_AUTH_URL) {\r\n      throw new Error(\"you need to set spotify url\");\r\n    }\r\n\r\n    if (!process.env.REACT_APP_SPOTIFY_CLIENT_ID) {\r\n      throw new Error(\"you need to set spotify client id\");\r\n    }\r\n\r\n    var url = new URL(process.env.REACT_APP_SPOTIFY_AUTH_URL);\r\n\r\n    url.searchParams.set(\"client_id\", process.env.REACT_APP_SPOTIFY_CLIENT_ID);\r\n    url.searchParams.set(\"response_type\", \"token\");\r\n    url.searchParams.set(\"redirect_uri\", SpotifyUtil.getSpotifyRedirectUrl());\r\n    url.searchParams.set(\"scope\", this.SCOPES.join(\" \"));\r\n\r\n    return url.toString();\r\n  }\r\n\r\n  static createPlayer(accessToken: string): Promise<SpotifyPlayer> {\r\n    return new Promise((resolve, reject) => {\r\n      window.onSpotifyWebPlaybackSDKReady = () => {\r\n        const player = new Spotify.Player({\r\n          name: 'Spotify plugin',\r\n          getOAuthToken: cb => { cb(accessToken); }\r\n        });\r\n\r\n        // Error handling\r\n        player.addListener('initialization_error', ({ message }) => reject(message));\r\n        player.addListener('authentication_error', ({ message }) => reject(message));\r\n        player.addListener('account_error', ({ message }) => reject(message));\r\n        player.addListener('playback_error', ({ message }) => reject(message));\r\n        player.addListener('not_ready', ({ device_id }) => reject(`Device ID has gone offline ${device_id}`))\r\n\r\n        // Ready\r\n        player.addListener('ready', ({ device_id }) => resolve({ device_id, original: player }));\r\n\r\n        // Connect to the player!\r\n        player.connect();\r\n      };\r\n\r\n      loadSpotifyScripts().catch(reject);\r\n    })\r\n  }\r\n\r\n  static getApiUrl(): string {\r\n    return process.env.REACT_APP_SPOTIFY_API_URL || \"https://api.spotify.com/v1\";\r\n  }\r\n\r\n  static getTokenAndInfoFromRedirectUrl(redirectUrl: string): SpotifyToken {\r\n    var url = new URL(redirectUrl);\r\n\r\n    url.search = url.hash.slice(2, url.hash.length);\r\n\r\n    const accessToken = url.searchParams.get(\"access_token\");\r\n    const expiresInSeconds = Number(url.searchParams.get(\"expires_in\"));\r\n    const tokenType = url.searchParams.get(\"token_type\");\r\n\r\n    if (!accessToken || !expiresInSeconds || !tokenType) {\r\n      throw new Error(\"Invalid redirect parameter\");\r\n    }\r\n\r\n    return {\r\n      accessToken,\r\n      expiresInSeconds,\r\n      tokenType,\r\n    };\r\n  }\r\n\r\n  private static getSpotifyRedirectUrl(): string {\r\n    if (!process.env.REACT_APP_HOST_URL) {\r\n      throw new Error(\"you need to set spotify client id\");\r\n    }\r\n\r\n    var url = new URL(process.env.REACT_APP_HOST_URL);\r\n\r\n    url.hash = \"/login-redirect-spotify\";\r\n\r\n    return url.toString();\r\n  }\r\n}\r\n"],"sourceRoot":""}